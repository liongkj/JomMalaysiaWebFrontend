<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
<script>cloudinary.setCloudName("jomn9-com");

function uploadImageWidget(folder, imageType){
        let field = imageType;
        let isLogo = field.indexOf("logo")>=0;
        let isCover = field.indexOf("cover")>=0;
        let isAds = field.indexOf("ads")>=0;
        cloudinary.openUploadWidget(
            {
                cloudName: 'jomn9-com',
                uploadPreset: 'ox3azzqe',
                apiKey: '731121621859821',
                folder: folder,
                sources: ["local", "image_search"],
                
                googleApiKey: 'AIzaSyCZseAlp_Rd9CxaJtOQBVKvpkBl8gHiXvk',
                searchBySites: ["all", "unsplash.com", "freepik.com"],
                croppingAspectRatio: isLogo?1:isCover?1.3:0.6,
                cropping: isAds?false:"server",
                croppingShowDimensions:true,
                multiple:isAds,
                showCompleted:true,
                croppingShowBackButton:true,
                resourceType: ["image"],
                clientAllowedFormats: ["png", "jpg", "jpeg"],
                minImageWidth: 100,
                minImageHeight: 100,
                showSkipCropButton: true,
                thumbnails:".image-thumbnail."+field,
                thumbnailTransformation : "w_150,h_150,c_fill"
            }, (error, result) => {
                if (!error) {    
                     console.log("Upload Widget event - ", result);
                   }
                
                if(result.event === "upload-added"){
                   setLoading(true);
                }
                if (!error && result && result.event === "success" ) {
                    setLoading(false); 
                    if(!isAds){
                        $(".imageUrl."+ field).val(result.info.secure_url);
                        $(".imageName."+ field).val(result.info.original_filename + "." + result.info.format);                  
                    }
                        }
            }
        )
}

function parseAdsImage(){
    let adList = $(".image-thumbnail.listing-ads ul").children();
   let adCount =0;
    adList.each(function(){
        let url = $(this).data("cloudinary").secure_url;
        $(".ads-group").append('<input name="ListingImages.Ads[' + adCount +'].Url" type="hidden" ' +
                                     'value="'+url+'">');
        adCount+=1;
        });
    
    
                            
}
        
   function setLoading(loading){
        let submitButton = $(".submitButton"); 
        let backButton = $(".cancelButton");
        
         submitButton.attr("disabled",loading);
         backButton.attr("disabled",loading);
   }

</script>